<!DOCTYPE html>
<html lang="en" data-country="pan-african">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment | Bridge55 Car Rentals</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #FF6B35;
            --primary-dark: #e55a2b;
            --secondary: #1a1a2e;
            --success: #28a745;
            --text-dark: #212529;
            --text-muted: #6c757d;
            --border-color: #dee2e6;
            --card-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        /* Country Theme Variables */
        [data-country="kenya"] { --primary: #BB0000; --primary-dark: #990000; }
        [data-country="ghana"] { --primary: #EF3340; --primary-dark: #d62b37; }
        [data-country="nigeria"] { --primary: #008751; --primary-dark: #006b41; }
        [data-country="south-africa"] { --primary: #007749; --primary-dark: #005c38; }
        [data-country="egypt"] { --primary: #C8102E; --primary-dark: #a60d26; }
        [data-country="tanzania"] { --primary: #00A3DD; --primary-dark: #0088bb; }
        [data-country="morocco"] { --primary: #C1272D; --primary-dark: #a11f24; }
        [data-country="rwanda"] { --primary: #00A1DE; --primary-dark: #0088bb; }
        [data-country="uganda"] { --primary: #D90000; --primary-dark: #b30000; }
        [data-country="cote-divoire"] { --primary: #FF8200; --primary-dark: #e67300; }
        [data-country="zambia"] { --primary: #198754; --primary-dark: #146c43; }

        * { font-family: 'Inter', sans-serif; }
        body { background: #f5f5f5; }

        .top-nav {
            background: linear-gradient(135deg, var(--secondary) 0%, #16213e 100%);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo { font-size: 1.5rem; font-weight: 800; color: white; text-decoration: none; }
        .logo span { color: var(--primary); }
        .secure-badge { background: rgba(40, 167, 69, 0.2); color: #28a745; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600; }

        .payment-container { max-width: 1200px; margin: 0 auto; padding: 2rem 1rem; }

        /* Payment Methods */
        .payment-method {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 16px;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        .payment-method:hover { border-color: var(--primary); box-shadow: 0 4px 12px rgba(255,107,53,0.15); }
        .payment-method.selected { border-color: var(--primary); box-shadow: 0 4px 20px rgba(255,107,53,0.2); }
        .payment-method.recommended { border-color: var(--primary); }
        
        .method-header {
            padding: 1.25rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .method-icon {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
        }
        .icon-wallet { background: linear-gradient(135deg, #FF6B35 0%, #ff8f5a 100%); }
        .icon-mobile { background: linear-gradient(135deg, #4CAF50 0%, #66BB6A 100%); }
        .icon-card { background: linear-gradient(135deg, #1565c0 0%, #42a5f5 100%); }
        .icon-bank { background: linear-gradient(135deg, #795548 0%, #a1887f 100%); }
        
        .method-info { flex: 1; }
        .method-name { font-weight: 700; font-size: 1.1rem; color: var(--text-dark); }
        .method-desc { font-size: 0.85rem; color: var(--text-muted); margin-top: 0.25rem; }
        .method-badge { background: var(--primary); color: white; padding: 0.35rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 700; }
        
        .method-body { padding: 0 1.5rem 1.5rem; display: none; }
        .method-body.show { display: block; }

        /* Bridge Wallet Styles */
        .wallet-balance {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .balance-amount { font-size: 2.5rem; font-weight: 800; color: var(--text-dark); }
        .balance-status { margin-top: 0.5rem; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .balance-status.sufficient { color: #28a745; }
        .balance-status.insufficient { color: #dc3545; }

        .visa-card {
            background: linear-gradient(135deg, var(--primary) 0%, #ff8f5a 100%);
            border-radius: 16px;
            padding: 1.5rem;
            color: white;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        .visa-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: rgba(255,255,255,0.1);
            transform: rotate(30deg);
        }
        .card-number { font-size: 1.25rem; letter-spacing: 3px; margin: 1.5rem 0; font-family: monospace; }

        .btn-success-custom {
            background: linear-gradient(135deg, #28a745 0%, #34ce57 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }
        .btn-success-custom:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(40,167,69,0.3); }

        /* Mobile Money Grid */
        .mobile-money-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        .mobile-money-option {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .mobile-money-option:hover { border-color: var(--primary); background: rgba(255,107,53,0.05); }
        .mobile-money-option.selected { border-color: var(--primary); background: rgba(255,107,53,0.1); }
        .mobile-money-option img { height: 40px; margin-bottom: 0.5rem; object-fit: contain; }
        .mobile-money-option .operator-name { font-weight: 600; font-size: 0.9rem; }

        .mobile-money-form { margin-top: 1.5rem; display: none; }
        .mobile-money-form.show { display: block; }

        .btn-pay-method {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            margin-top: 1.5rem;
            transition: all 0.3s;
        }
        .btn-pay-method:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(255,107,53,0.3); }

        /* Bank Transfer Styles - Enhanced Card Style */
        .bank-transfer-card {
            background: white;
            border: 2px solid var(--primary);
            border-radius: 16px;
            overflow: hidden;
        }
        .bank-transfer-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid #e9ecef;
        }
        .bank-icon-box {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #a1887f 0%, #795548 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
        }
        .bank-header-info h6 {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.25rem;
        }
        .bank-header-info p {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin: 0;
        }
        .bank-transfer-body {
            padding: 1.5rem;
        }
        .transfer-type-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }
        .transfer-type-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.25rem;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        .transfer-type-option:hover { border-color: var(--primary); }
        .transfer-type-option.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(255,107,53,0.05) 0%, rgba(255,107,53,0.1) 100%);
        }
        .transfer-type-option input[type="radio"] { display: none; }
        .transfer-type-option .option-radio {
            width: 22px;
            height: 22px;
            border: 2px solid #dee2e6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .transfer-type-option.selected .option-radio {
            border-color: var(--primary);
            background: var(--primary);
        }
        .transfer-type-option.selected .option-radio::after {
            content: '';
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
        }
        .transfer-type-option .option-info h6 {
            font-weight: 700;
            margin-bottom: 0.25rem;
            font-size: 0.95rem;
        }
        .transfer-type-option .option-info p {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin: 0;
        }
        .bank-details-section {
            margin-bottom: 1.5rem;
        }
        .section-title-sm {
            font-weight: 700;
            font-size: 0.95rem;
            margin-bottom: 1rem;
            color: var(--text-dark);
        }
        .bank-form-car { display: none; }
        .bank-form-car.show { display: block; }
        .bank-notice {
            background: linear-gradient(135deg, #fff3cd 0%, #ffe69c 100%);
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 1rem 1.25rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
            color: #856404;
        }
        .bank-notice i { color: #856404; margin-top: 2px; }
        .btn-submit-bank {
            width: 100%;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.3s;
        }
        .btn-submit-bank:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,107,53,0.4);
        }
        
        /* Legacy support */
        .transfer-type {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        .transfer-type:hover { border-color: var(--primary); }
        .transfer-type.selected { border-color: var(--primary); background: rgba(255,107,53,0.05); }

        /* Sidebar */
        .payment-sidebar { position: sticky; top: 100px; }
        .summary-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 1rem;
        }
        .rental-summary {
            display: flex;
            gap: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1rem;
        }
        .rental-summary img { width: 100px; height: 70px; object-fit: cover; border-radius: 8px; }
        .rental-summary-info h4 { margin: 0; font-size: 1rem; font-weight: 700; }
        .rental-summary-info p { margin: 0; font-size: 0.85rem; color: var(--text-muted); }

        .price-row { display: flex; justify-content: space-between; padding: 0.5rem 0; font-size: 0.9rem; }
        .price-row.total { border-top: 2px solid var(--border-color); margin-top: 0.75rem; padding-top: 0.75rem; font-weight: 700; font-size: 1.1rem; }

        .btn-pay {
            width: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 1rem;
        }
        .btn-pay:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(255,107,53,0.3); }

        /* Help Card */
        .help-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
        }
        .help-title { font-weight: 700; margin-bottom: 1rem; }
        .help-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem 0; font-size: 0.9rem; }
        .help-item i { color: var(--primary); width: 20px; }

        /* Top-up Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .modal-overlay.show { display: flex; }
        .topup-modal {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2rem;
        }
        .amount-quick-select { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; margin-bottom: 1.5rem; }
        .amount-option {
            padding: 1rem;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            text-align: center;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }
        .amount-option:hover { border-color: var(--primary); }
        .amount-option.selected { border-color: var(--primary); background: rgba(255,107,53,0.1); color: var(--primary); }

        .security-badges { display: flex; justify-content: center; gap: 1.5rem; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color); }
        .security-badge { display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; color: var(--text-muted); }
        .security-badge i { color: var(--success); }

        @media (max-width: 992px) {
            .payment-sidebar { position: static; margin-top: 2rem; }
        }
    </style>
</head>
<body>

<nav class="top-nav">
    <div style="display: flex; align-items: center; gap: 1rem;">
        <a href="../bridge55-search-hub-FINAL.html" class="logo">Bridge<span>55</span></a>
    </div>
    <div style="display: flex; align-items: center; gap: 1.5rem;">
        <a href="booking.html" style="color: #6c757d; text-decoration: none; font-weight: 600; font-size: 0.9rem;">
            <i class="fas fa-arrow-left me-2"></i>Back to Booking
        </a>
        <div class="secure-badge">
            <i class="fas fa-lock me-1"></i>Secure Connection
        </div>
    </div>
</nav>

<div class="payment-container">
    <div class="row">
        <div class="col-lg-8">
            
            <h2 style="font-weight: 800; margin-bottom: 0.5rem;">Select Payment Method</h2>
            <p style="color: #6c757d; margin-bottom: 2rem;">Choose how you'd like to pay. All transactions are secure and encrypted.</p>

            <!-- BRIDGE WALLET (ALWAYS FIRST & RECOMMENDED) -->
            <div class="payment-method recommended selected" onclick="selectMethod('wallet')">
                <div class="method-header">
                    <div class="method-icon icon-wallet">üí≥</div>
                    <div class="method-info">
                        <div class="method-name">Bridge Wallet</div>
                        <div class="method-desc">‚úì Instant payment ‚Ä¢ No fees ‚Ä¢ Earn 2% cashback</div>
                    </div>
                    <div class="method-badge">RECOMMENDED</div>
                </div>
                <div class="method-body show" id="wallet-body">
                    <div class="wallet-balance">
                        <div style="font-size: 0.9rem; color: #6c757d; margin-bottom: 0.5rem;">Current Balance</div>
                        <div class="balance-amount" id="walletBalance">$1,247.50</div>
                        <div class="balance-status sufficient" id="balanceStatus">
                            <i class="fas fa-check-circle"></i>
                            <span>Sufficient funds for this rental</span>
                        </div>
                    </div>
                    
                    <div class="visa-card">
                        <div style="display: flex; justify-content: space-between; align-items: center; position: relative; z-index: 1;">
                            <span style="font-size: 1rem; font-weight: 700;">BRIDGE</span>
                            <span style="font-size: 1.5rem; font-weight: 700;">VISA</span>
                        </div>
                        <div class="card-number" style="position: relative; z-index: 1;">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4532</div>
                        <div style="display: flex; justify-content: space-between; position: relative; z-index: 1;">
                            <span style="font-weight: 600;">JOHN DOE</span>
                            <span style="font-weight: 600;">12/26</span>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-bottom: 1rem;">
                        <p style="font-size: 0.9rem; color: #6c757d; margin-bottom: 1rem;">
                            üéÅ <strong>Earn 2% cashback</strong> on this rental when you pay with Bridge Wallet!
                        </p>
                        <button class="btn-success-custom" onclick="openTopUpModal()">
                            <i class="fas fa-plus me-2"></i>Add Funds to Wallet
                        </button>
                    </div>
                    
                    <button class="btn-pay-method" onclick="initiatePayment('wallet')" id="wallet-submit">
                        <i class="fas fa-wallet"></i>
                        <span>Pay $<span id="walletPayAmount">510</span> with Bridge Wallet</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- MOBILE MONEY (GROUPED) -->
            <div class="payment-method" onclick="selectMethod('mobile-money')">
                <div class="method-header">
                    <div class="method-icon icon-mobile">üì±</div>
                    <div class="method-info">
                        <div class="method-name">Mobile Money</div>
                        <div class="method-desc">M-Pesa ‚Ä¢ MTN MoMo ‚Ä¢ Airtel Money ‚Ä¢ Orange Money ‚Ä¢ Instant</div>
                    </div>
                </div>
                <div class="method-body" id="mobile-money-body">
                    <p style="font-size: 0.9rem; color: #6c757d; margin-bottom: 1rem;">Select your mobile money provider:</p>
                    
                    <div class="mobile-money-grid">
                        <div class="mobile-money-option" onclick="event.stopPropagation(); selectMobileOperator('mpesa')">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/15/M-PESA_LOGO-01.svg/200px-M-PESA_LOGO-01.svg.png" alt="M-Pesa">
                            <div class="operator-name">M-Pesa</div>
                            <div style="font-size: 0.75rem; color: #6c757d;">Kenya ‚Ä¢ Tanzania</div>
                        </div>
                        <div class="mobile-money-option" onclick="event.stopPropagation(); selectMobileOperator('mtn')">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/93/New-mtn-logo.svg/200px-New-mtn-logo.svg.png" alt="MTN">
                            <div class="operator-name">MTN MoMo</div>
                            <div style="font-size: 0.75rem; color: #6c757d;">Ghana ‚Ä¢ Uganda ‚Ä¢ Rwanda</div>
                        </div>
                        <div class="mobile-money-option" onclick="event.stopPropagation(); selectMobileOperator('airtel')">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Airtel_Africa_logo.svg/200px-Airtel_Africa_logo.svg.png" alt="Airtel">
                            <div class="operator-name">Airtel Money</div>
                            <div style="font-size: 0.75rem; color: #6c757d;">Kenya ‚Ä¢ Uganda ‚Ä¢ Tanzania</div>
                        </div>
                        <div class="mobile-money-option" onclick="event.stopPropagation(); selectMobileOperator('orange')">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c8/Orange_logo.svg/200px-Orange_logo.svg.png" alt="Orange">
                            <div class="operator-name">Orange Money</div>
                            <div style="font-size: 0.75rem; color: #6c757d;">C√¥te d'Ivoire ‚Ä¢ Senegal</div>
                        </div>
                    </div>

                    <!-- M-Pesa Form -->
                    <div class="mobile-money-form" id="mpesa-form">
                        <h6 style="font-weight: 700; margin-bottom: 1rem;"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/15/M-PESA_LOGO-01.svg/80px-M-PESA_LOGO-01.svg.png" alt="M-Pesa" style="height: 24px; margin-right: 0.5rem;"> M-Pesa Payment</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Select Country *</label>
                                <select class="form-select" id="mpesa-country">
                                    <option value="+254">üá∞üá™ Kenya (+254)</option>
                                    <option value="+255">üáπüáø Tanzania (+255)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Phone Number *</label>
                                <div class="input-group">
                                    <span class="input-group-text" id="mpesa-code">+254</span>
                                    <input type="tel" class="form-control" placeholder="712 345 678" id="mpesa-phone">
                                </div>
                            </div>
                        </div>
                        <button class="btn-pay-method" onclick="initiatePayment('mpesa')">
                            <i class="fas fa-mobile-alt"></i>
                            <span>Pay via M-Pesa</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>

                    <!-- MTN Form -->
                    <div class="mobile-money-form" id="mtn-form">
                        <h6 style="font-weight: 700; margin-bottom: 1rem;"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/93/New-mtn-logo.svg/80px-New-mtn-logo.svg.png" alt="MTN" style="height: 24px; margin-right: 0.5rem;"> MTN MoMo Payment</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Select Country *</label>
                                <select class="form-select" id="mtn-country">
                                    <option value="+233">üá¨üá≠ Ghana (+233)</option>
                                    <option value="+256">üá∫üá¨ Uganda (+256)</option>
                                    <option value="+250">üá∑üáº Rwanda (+250)</option>
                                    <option value="+237">üá®üá≤ Cameroon (+237)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Phone Number *</label>
                                <div class="input-group">
                                    <span class="input-group-text" id="mtn-code">+233</span>
                                    <input type="tel" class="form-control" placeholder="24 123 4567" id="mtn-phone">
                                </div>
                            </div>
                        </div>
                        <button class="btn-pay-method" onclick="initiatePayment('mtn')">
                            <i class="fas fa-mobile-alt"></i>
                            <span>Pay via MTN MoMo</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>

                    <!-- Airtel Form -->
                    <div class="mobile-money-form" id="airtel-form">
                        <h6 style="font-weight: 700; margin-bottom: 1rem;"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Airtel_Africa_logo.svg/80px-Airtel_Africa_logo.svg.png" alt="Airtel" style="height: 24px; margin-right: 0.5rem;"> Airtel Money Payment</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Select Country *</label>
                                <select class="form-select" id="airtel-country">
                                    <option value="+254">üá∞üá™ Kenya (+254)</option>
                                    <option value="+256">üá∫üá¨ Uganda (+256)</option>
                                    <option value="+255">üáπüáø Tanzania (+255)</option>
                                    <option value="+260">üáøüá≤ Zambia (+260)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Phone Number *</label>
                                <div class="input-group">
                                    <span class="input-group-text" id="airtel-code">+254</span>
                                    <input type="tel" class="form-control" placeholder="712 345 678" id="airtel-phone">
                                </div>
                            </div>
                        </div>
                        <button class="btn-pay-method" onclick="initiatePayment('airtel')">
                            <i class="fas fa-mobile-alt"></i>
                            <span>Pay via Airtel Money</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>

                    <!-- Orange Form -->
                    <div class="mobile-money-form" id="orange-form">
                        <h6 style="font-weight: 700; margin-bottom: 1rem;"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c8/Orange_logo.svg/80px-Orange_logo.svg.png" alt="Orange" style="height: 24px; margin-right: 0.5rem;"> Orange Money Payment</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Select Country *</label>
                                <select class="form-select" id="orange-country">
                                    <option value="+225">üá®üáÆ C√¥te d'Ivoire (+225)</option>
                                    <option value="+221">üá∏üá≥ Senegal (+221)</option>
                                    <option value="+223">üá≤üá± Mali (+223)</option>
                                    <option value="+226">üáßüá´ Burkina Faso (+226)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Phone Number *</label>
                                <div class="input-group">
                                    <span class="input-group-text" id="orange-code">+225</span>
                                    <input type="tel" class="form-control" placeholder="XX XX XX XX XX" id="orange-phone">
                                </div>
                            </div>
                        </div>
                        <button class="btn-pay-method" onclick="initiatePayment('orange')">
                            <i class="fas fa-mobile-alt"></i>
                            <span>Pay via Orange Money</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- CREDIT/DEBIT CARD -->
            <div class="payment-method" onclick="selectMethod('card')">
                <div class="method-header">
                    <div class="method-icon icon-card">üí≥</div>
                    <div class="method-info">
                        <div class="method-name">Credit/Debit Card</div>
                        <div class="method-desc">Visa ‚Ä¢ Mastercard ‚Ä¢ Amex ‚Ä¢ 3D Secure Protected</div>
                    </div>
                </div>
                <div class="method-body" id="card-body">
                    <div class="row g-3">
                        <div class="col-12">
                            <label class="form-label">Card Number * <span style="color: #6c757d; font-weight: 400;">(16 digits)</span></label>
                            <input type="text" class="form-control" placeholder="1234 5678 9012 3456" maxlength="19" id="card-number">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Expiry Date *</label>
                            <input type="text" class="form-control" placeholder="MM/YY" maxlength="5" id="card-expiry">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">CVV * <span style="color: #6c757d; font-weight: 400;">(3-4 digits)</span></label>
                            <input type="text" class="form-control" placeholder="123" maxlength="4" id="card-cvv">
                        </div>
                        <div class="col-12">
                            <label class="form-label">Cardholder Name *</label>
                            <input type="text" class="form-control" placeholder="JOHN DOE" style="text-transform: uppercase;" id="card-name">
                        </div>
                        <div class="col-12">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="save-card">
                                <label class="form-check-label" for="save-card">
                                    Save card for future bookings (secure tokenization)
                                </label>
                            </div>
                        </div>
                    </div>
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-top: 1rem; font-size: 0.85rem; color: #6c757d;">
                        <i class="fas fa-shield-alt me-2"></i>
                        Protected by 3D Secure. You may be redirected to your bank for verification.
                    </div>
                    <button class="btn-pay-method" onclick="initiatePayment('card')">
                        <i class="fas fa-credit-card"></i>
                        <span>Pay $<span id="cardPayAmount">510</span> via Card</span>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- BANK TRANSFER - Enhanced Card Style -->
            <div class="payment-method" onclick="selectMethod('bank')">
                <div class="method-header">
                    <div class="method-icon icon-bank">üè¶</div>
                    <div class="method-info">
                        <div class="method-name">Bank Transfer</div>
                        <div class="method-desc">African Banks (2-3 days, Free) ‚Ä¢ International Wire (3-5 days, $15)</div>
                    </div>
                </div>
                <div class="method-body" id="bank-body">
                    <div class="bank-transfer-card">
                        <div class="bank-transfer-header">
                            <div class="bank-icon-box">üè¶</div>
                            <div class="bank-header-info">
                                <h6>Bank Transfer</h6>
                                <p>African Banks (2-3 days, Free) ‚Ä¢ International Wire (3-5 days, $15)</p>
                            </div>
                        </div>
                        
                        <div class="bank-transfer-body">
                            <label class="form-label" style="margin-bottom: 0.75rem;">Select Transfer Type *</label>
                            
                            <!-- Transfer Type Options -->
                            <div class="transfer-type-options">
                                <label class="transfer-type-option selected" data-type="local" onclick="event.stopPropagation(); selectTransferTypeNew('local')">
                                    <input type="radio" name="transferType" value="local" checked>
                                    <span class="option-radio"></span>
                                    <div class="option-info">
                                        <h6>African Banks (Local Transfer)</h6>
                                        <p>2-3 business days ‚Ä¢ Free ‚Ä¢ Recommended for Africa</p>
                                    </div>
                                </label>
                                
                                <label class="transfer-type-option" data-type="intl" onclick="event.stopPropagation(); selectTransferTypeNew('intl')">
                                    <input type="radio" name="transferType" value="intl">
                                    <span class="option-radio"></span>
                                    <div class="option-info">
                                        <h6>International Wire Transfer</h6>
                                        <p>3-5 business days ‚Ä¢ $15 fee ‚Ä¢ For non-African banks</p>
                                    </div>
                                </label>
                            </div>
                            
                            <!-- Your Bank Details Section -->
                            <div class="bank-details-section">
                                <h6 class="section-title-sm">Your Bank Details</h6>
                                
                                <!-- African Bank Form -->
                                <div class="bank-form-car show" id="local-bank-form-new">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Bank Name *</label>
                                            <select class="form-select">
                                                <option value="">Select your bank</option>
                                                <option selected>Kenya Commercial Bank (KCB)</option>
                                                <option>Equity Bank Kenya</option>
                                                <option>Standard Bank (South Africa)</option>
                                                <option>First Bank (Nigeria)</option>
                                                <option>Ecobank (Pan-African)</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Account Type *</label>
                                            <select class="form-select">
                                                <option selected>Checking</option>
                                                <option>Savings</option>
                                                <option>Current</option>
                                            </select>
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">Account Holder Name *</label>
                                            <input type="text" class="form-control" placeholder="John Doe" value="John Doe">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Account Number *</label>
                                            <input type="text" class="form-control" placeholder="1234567890" value="1234567890">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Branch Name (Optional)</label>
                                            <input type="text" class="form-control" placeholder="Westlands Branch" value="Westlands Branch">
                                        </div>
                                    </div>
                                </div>

                                <!-- International Bank Form -->
                                <div class="bank-form-car" id="intl-bank-form-new">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Bank Name *</label>
                                            <input type="text" class="form-control" placeholder="Citibank" value="Citibank">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">SWIFT/BIC Code *</label>
                                            <input type="text" class="form-control" placeholder="CITIUS33" value="CITIUS33" style="text-transform: uppercase;">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Account Number *</label>
                                            <input type="text" class="form-control" placeholder="9876543210" value="9876543210">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">IBAN (If applicable)</label>
                                            <input type="text" class="form-control" placeholder="GB29 NWBK 6016 1331 9268 19" value="GB29 NWBK 6016 1331 9268 19">
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">Account Holder Name *</label>
                                            <input type="text" class="form-control" placeholder="John Doe" value="John Doe">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Important Notice -->
                            <div class="bank-notice">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span><strong>Important:</strong> After submitting, you'll receive bank transfer instructions with a unique reference number. Please complete the transfer within 24 hours to secure your booking.</span>
                            </div>
                            
                            <button class="btn-submit-bank" onclick="event.stopPropagation(); initiatePayment('bank')">
                                <i class="fas fa-university me-2"></i> Submit Bank Transfer Request <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="security-badges">
                <div class="security-badge">
                    <i class="fas fa-lock"></i>
                    <span>256-bit SSL</span>
                </div>
                <div class="security-badge">
                    <i class="fas fa-shield-alt"></i>
                    <span>PCI Compliant</span>
                </div>
                <div class="security-badge">
                    <i class="fas fa-check-circle"></i>
                    <span>Secure Payment</span>
                </div>
            </div>
        </div>

        <!-- Right Column - Summary -->
        <div class="col-lg-4">
            <div class="payment-sidebar">
                <div class="summary-card">
                    <h4 style="font-weight: 700; margin-bottom: 1rem;"><i class="fas fa-car text-primary me-2"></i>Rental Summary</h4>
                    
                    <div class="rental-summary">
                        <img src="https://images.unsplash.com/photo-1519641471654-76ce0107ad1b?w=150&h=100&fit=crop" alt="Toyota RAV4" id="carImage">
                        <div class="rental-summary-info">
                            <h4 id="carName">Toyota RAV4</h4>
                            <p id="carCategory">SUV ¬∑ Automatic</p>
                            <p id="rentalCompany">Europcar Kenya</p>
                        </div>
                    </div>

                    <div class="mb-3">
                        <div class="d-flex justify-content-between text-muted small mb-2">
                            <span><i class="fas fa-map-marker-alt me-1"></i> Pick-up</span>
                            <span id="pickupInfo">NBO Airport ¬∑ Dec 15, 2025</span>
                        </div>
                        <div class="d-flex justify-content-between text-muted small">
                            <span><i class="fas fa-map-marker-alt me-1"></i> Return</span>
                            <span id="returnInfo">NBO Airport ¬∑ Dec 20, 2025</span>
                        </div>
                    </div>

                    <!-- Coupon Code Section -->
                    <div class="coupon-section" style="margin-bottom: 1rem; padding: 0.75rem; background: #f8f9fa; border-radius: 8px; border: 1px dashed #dee2e6;">
                        <div class="coupon-header" onclick="toggleCouponInput()" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; color: var(--primary); font-weight: 600; font-size: 0.85rem;">
                            <i class="fas fa-tag"></i>
                            <span>Have a promo code?</span>
                            <i class="fas fa-chevron-down" id="couponArrow" style="margin-left: auto; transition: transform 0.3s;"></i>
                        </div>
                        <div id="couponInputWrapper" style="display: none; margin-top: 0.75rem;">
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="text" class="form-control" id="couponCode" placeholder="Enter code" style="flex: 1; text-transform: uppercase; letter-spacing: 1px; font-size: 0.85rem; padding: 0.5rem;">
                                <button class="btn" style="background: var(--primary); color: white; font-weight: 600; font-size: 0.8rem; padding: 0.5rem 0.75rem; border-radius: 8px;" onclick="applyCoupon()">Apply</button>
                            </div>
                            <div id="couponMessage" style="margin-top: 0.5rem; font-size: 0.8rem;"></div>
                        </div>
                        <div id="appliedCoupon" style="display: none; margin-top: 0.75rem; padding: 0.5rem; background: #d4edda; border-radius: 6px;">
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span style="color: #155724; font-weight: 600; font-size: 0.85rem;">
                                    <i class="fas fa-check-circle me-1"></i>
                                    <span id="appliedCouponCode">DRIVE25</span>
                                </span>
                                <button onclick="removeCoupon()" style="background: none; border: none; color: #6c757d; cursor: pointer; font-size: 0.75rem;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="price-row">
                        <span>Car rental (<span id="daysCount">5</span> days)</span>
                        <span id="basePrice">$350</span>
                    </div>
                    <div class="price-row">
                        <span>Insurance</span>
                        <span id="insurancePrice">$75</span>
                    </div>
                    <div class="price-row">
                        <span>Add-ons</span>
                        <span id="addonsPrice">$0</span>
                    </div>
                    <div class="price-row" style="color: #6c757d;">
                        <span>Platform fee (5%)</span>
                        <span id="platformFee">$21</span>
                    </div>
                    <div class="price-row" style="color: #6c757d;">
                        <span>Taxes & fees</span>
                        <span id="taxesPrice">$64</span>
                    </div>
                    <div class="price-row" id="discountRow" style="color: #28a745; display: none;">
                        <span><i class="fas fa-tag me-1"></i>Promo Discount</span>
                        <span id="discountAmount">-$0</span>
                    </div>
                    <div class="price-row total">
                        <span>Total</span>
                        <span class="text-primary" id="totalPrice">$510</span>
                    </div>

                    <div class="text-center mt-3">
                        <small class="text-muted">
                            <i class="fas fa-shield-alt me-1"></i> Your payment is secure and encrypted
                        </small>
                    </div>
                </div>

                <!-- Help Card with Business Info -->
                <div class="help-card">
                    <div class="d-flex align-items-center gap-3 mb-3 pb-3 border-bottom">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/9b/Europcar_logo.svg/100px-Europcar_logo.svg.png" 
                             alt="Europcar Kenya" style="height: 35px; object-fit: contain;">
                        <div>
                            <h5 class="mb-0" id="businessNameHelp">Europcar Kenya</h5>
                            <small class="text-muted">Verified Partner</small>
                        </div>
                    </div>
                    <h4 class="help-title">Need Help?</h4>
                    <div class="help-item">
                        <i class="fas fa-phone"></i>
                        <span>+254 700 123 456</span>
                    </div>
                    <div class="help-item">
                        <i class="fas fa-envelope"></i>
                        <span>cars@bridge55.com</span>
                    </div>
                    <div class="d-flex gap-2 mt-3">
                        <a href="tel:+254700123456" class="btn btn-outline-primary btn-sm flex-fill">
                            <i class="fas fa-phone me-1"></i> Call
                        </a>
                        <a href="https://wa.me/254700123456" class="btn btn-success btn-sm flex-fill" target="_blank">
                            <i class="fab fa-whatsapp me-1"></i> WhatsApp
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Top-up Modal -->
<div class="modal-overlay" id="topupModal">
    <div class="topup-modal">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h4 style="font-weight: 800; margin: 0;">Add Funds to Wallet</h4>
            <button onclick="closeTopUpModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6c757d;">&times;</button>
        </div>
        
        <div class="amount-quick-select">
            <div class="amount-option" onclick="selectTopUpAmount(50)">$50</div>
            <div class="amount-option" onclick="selectTopUpAmount(100)">$100</div>
            <div class="amount-option" onclick="selectTopUpAmount(200)">$200</div>
            <div class="amount-option selected" onclick="selectTopUpAmount(500)">$500</div>
            <div class="amount-option" onclick="selectTopUpAmount(1000)">$1,000</div>
            <div class="amount-option" onclick="selectTopUpAmount('custom')">Custom</div>
        </div>

        <div class="mb-3" id="customAmountDiv" style="display: none;">
            <label class="form-label">Enter Amount</label>
            <div class="input-group">
                <span class="input-group-text">$</span>
                <input type="number" class="form-control" id="customAmount" placeholder="Enter amount">
            </div>
        </div>

        <div class="mb-3">
            <label class="form-label">Top-up Method</label>
            <select class="form-select" id="topupMethod">
                <option value="mpesa">M-Pesa</option>
                <option value="mtn">MTN MoMo</option>
                <option value="airtel">Airtel Money</option>
                <option value="orange">Orange Money</option>
                <option value="card">Credit/Debit Card</option>
                <option value="bank">Bank Transfer</option>
            </select>
        </div>

        <button class="btn-success-custom" onclick="processTopUp()">
            <i class="fas fa-plus me-2"></i>Add $500 to Wallet
        </button>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="../js/country-branding.js"></script>
<script>
    let selectedPayment = 'wallet';
    let selectedMobileOperator = null;
    let topUpAmount = 500;
    let totalAmount = 510;

    $(document).ready(function() {
        applyCountryBranding();
        loadBookingData();
        
        // Update country code on dropdown change
        $('#mpesa-country').on('change', function() { $('#mpesa-code').text($(this).val()); });
        $('#mtn-country').on('change', function() { $('#mtn-code').text($(this).val()); });
        $('#airtel-country').on('change', function() { $('#airtel-code').text($(this).val()); });
        $('#orange-country').on('change', function() { $('#orange-code').text($(this).val()); });
    });

    function applyCountryBranding() {
        const savedCountry = localStorage.getItem('bridge55_country') || 'pan-african';
        document.documentElement.setAttribute('data-country', savedCountry);
    }

    function loadBookingData() {
        const bookingData = sessionStorage.getItem('carBooking');
        if (bookingData) {
            const data = JSON.parse(bookingData);
            $('#carName').text(data.car || 'Toyota RAV4');
            $('#carCategory').text((data.category || 'SUV') + ' ¬∑ Automatic');
            $('#rentalCompany').text(data.company || 'Europcar Kenya');
            $('#pickupInfo').text((data.location || 'NBO Airport') + ' ¬∑ ' + (data.pickupDate || 'Dec 15, 2025'));
            $('#returnInfo').text((data.location || 'NBO Airport') + ' ¬∑ ' + (data.returnDate || 'Dec 20, 2025'));
            $('#daysCount').text(data.days || 5);
            $('#basePrice').text('$' + (data.basePrice || 350));
            $('#insurancePrice').text('$' + (data.insurance || 75));
            $('#addonsPrice').text('$' + (data.addons || 0));
            $('#platformFee').text('$' + (data.platformFee || 21));
            $('#taxesPrice').text('$' + (data.taxes || 64));
            totalAmount = data.total || 510;
            $('#totalPrice').text('$' + totalAmount);
            $('#walletPayAmount').text(totalAmount);
            $('#cardPayAmount').text(totalAmount);
            $('#businessNameHelp').text(data.company || 'Europcar Kenya');
        }
    }

    function selectMethod(method) {
        // Remove selected from all
        document.querySelectorAll('.payment-method').forEach(m => {
            m.classList.remove('selected');
            const body = m.querySelector('.method-body');
            if (body) body.classList.remove('show');
        });
        
        // Add selected to clicked
        event.currentTarget.classList.add('selected');
        const body = document.getElementById(method + '-body');
        if (body) body.classList.add('show');
        
        selectedPayment = method;
        
        // Reset mobile money forms
        document.querySelectorAll('.mobile-money-form').forEach(f => f.classList.remove('show'));
        document.querySelectorAll('.mobile-money-option').forEach(o => o.classList.remove('selected'));
    }

    function selectMobileOperator(operator) {
        // Remove selected from all options
        document.querySelectorAll('.mobile-money-option').forEach(o => o.classList.remove('selected'));
        event.currentTarget.classList.add('selected');
        
        // Hide all forms, show selected
        document.querySelectorAll('.mobile-money-form').forEach(f => f.classList.remove('show'));
        document.getElementById(operator + '-form').classList.add('show');
        
        selectedMobileOperator = operator;
    }

    function selectTransferType(type) {
        document.querySelectorAll('.transfer-type').forEach(t => {
            t.classList.remove('selected');
            t.querySelector('input').checked = false;
        });
        event.currentTarget.classList.add('selected');
        event.currentTarget.querySelector('input').checked = true;
        
        if (type === 'local') {
            document.getElementById('local-bank-form').style.display = 'block';
            document.getElementById('intl-bank-form').style.display = 'none';
        } else {
            document.getElementById('local-bank-form').style.display = 'none';
            document.getElementById('intl-bank-form').style.display = 'block';
        }
    }

    // New enhanced transfer type selector
    function selectTransferTypeNew(type) {
        // Update radio buttons and styling
        document.querySelectorAll('.transfer-type-option').forEach(el => {
            el.classList.remove('selected');
            const input = el.querySelector('input');
            if (input) input.checked = false;
        });
        const selected = document.querySelector(`.transfer-type-option[data-type="${type}"]`);
        if (selected) {
            selected.classList.add('selected');
            const input = selected.querySelector('input');
            if (input) input.checked = true;
        }
        
        // Show appropriate form
        document.querySelectorAll('.bank-form-car').forEach(el => el.classList.remove('show'));
        if (type === 'local') {
            document.getElementById('local-bank-form-new').classList.add('show');
        } else {
            document.getElementById('intl-bank-form-new').classList.add('show');
        }
    }

    function openTopUpModal() {
        document.getElementById('topupModal').classList.add('show');
    }

    function closeTopUpModal() {
        document.getElementById('topupModal').classList.remove('show');
    }

    function selectTopUpAmount(amount) {
        document.querySelectorAll('.amount-option').forEach(o => o.classList.remove('selected'));
        event.currentTarget.classList.add('selected');
        
        if (amount === 'custom') {
            document.getElementById('customAmountDiv').style.display = 'block';
            topUpAmount = 0;
        } else {
            document.getElementById('customAmountDiv').style.display = 'none';
            topUpAmount = amount;
        }
        
        document.querySelector('.topup-modal .btn-success-custom').innerHTML = 
            '<i class="fas fa-plus me-2"></i>Add $' + (topUpAmount || '___') + ' to Wallet';
    }

    function processTopUp() {
        // Simulate top-up
        alert('Top-up of $' + topUpAmount + ' initiated! You will receive a confirmation shortly.');
        closeTopUpModal();
    }

    function initiatePayment(method) {
        const btn = event.currentTarget;
        const originalContent = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Processing...';
        btn.disabled = true;

        // Simulate payment processing
        setTimeout(function() {
            // Store confirmation data
            const bookingData = JSON.parse(sessionStorage.getItem('carBooking') || '{}');
            
            sessionStorage.setItem('carConfirmation', JSON.stringify({
                confirmationNumber: 'BRG-CAR-' + Math.random().toString(36).substr(2, 9).toUpperCase(),
                ...bookingData,
                paymentMethod: method,
                paymentDate: new Date().toISOString()
            }));

            window.location.href = 'confirmation.html';
        }, 2000);
    }

    // COUPON FUNCTIONALITY
    let originalTotal = 510;
    let currentDiscount = 0;
    let appliedCouponCodeVal = null;

    const validCoupons = {
        'DRIVE25': { type: 'percent', value: 25, description: '25% off car rental' },
        'SAFARI15': { type: 'percent', value: 15, description: '15% Safari Special' },
        'FIRST20': { type: 'percent', value: 20, description: '20% first-time discount' },
        'WEEKEND10': { type: 'percent', value: 10, description: '10% weekend discount' },
        'BRIDGE10': { type: 'percent', value: 10, description: '10% Bridge55 Discount' }
    };

    function toggleCouponInput() {
        const wrapper = document.getElementById('couponInputWrapper');
        const arrow = document.getElementById('couponArrow');
        if (wrapper.style.display === 'none') {
            wrapper.style.display = 'block';
            arrow.style.transform = 'rotate(180deg)';
        } else {
            wrapper.style.display = 'none';
            arrow.style.transform = 'rotate(0deg)';
        }
    }

    function applyCoupon() {
        const code = document.getElementById('couponCode').value.toUpperCase().trim();
        const messageEl = document.getElementById('couponMessage');
        
        if (!code) {
            messageEl.innerHTML = '<span style="color: #dc3545;"><i class="fas fa-exclamation-circle me-1"></i>Please enter a code</span>';
            return;
        }
        
        if (validCoupons[code]) {
            const coupon = validCoupons[code];
            if (coupon.type === 'percent') {
                currentDiscount = totalAmount * (coupon.value / 100);
            } else {
                currentDiscount = coupon.value;
            }
            
            appliedCouponCodeVal = code;
            
            // Update UI
            document.getElementById('couponInputWrapper').style.display = 'none';
            document.getElementById('appliedCoupon').style.display = 'block';
            document.getElementById('appliedCouponCode').textContent = code;
            document.getElementById('discountRow').style.display = 'flex';
            document.getElementById('discountAmount').textContent = '-$' + currentDiscount.toFixed(0);
            
            const newTotal = totalAmount - currentDiscount;
            document.getElementById('totalPrice').textContent = '$' + newTotal.toFixed(0);
            document.getElementById('walletPayAmount').textContent = newTotal.toFixed(0);
            
            // Store in session for confirmation page
            sessionStorage.setItem('carCouponCode', code);
            sessionStorage.setItem('carCouponDiscount', currentDiscount.toFixed(2));
            
            messageEl.innerHTML = '';
        } else {
            messageEl.innerHTML = '<span style="color: #dc3545;"><i class="fas fa-times-circle me-1"></i>Invalid promo code</span>';
        }
    }

    function removeCoupon() {
        currentDiscount = 0;
        appliedCouponCodeVal = null;
        
        document.getElementById('couponCode').value = '';
        document.getElementById('appliedCoupon').style.display = 'none';
        document.getElementById('discountRow').style.display = 'none';
        document.getElementById('totalPrice').textContent = '$' + totalAmount;
        document.getElementById('walletPayAmount').textContent = totalAmount;
        
        sessionStorage.removeItem('carCouponCode');
        sessionStorage.removeItem('carCouponDiscount');
        
        toggleCouponInput();
    }

    // Check for pre-applied promo from search
    $(document).ready(function() {
        const savedPromo = sessionStorage.getItem('bridge55_coupon_code');
        if (savedPromo) {
            document.getElementById('couponCode').value = savedPromo;
            toggleCouponInput();
            setTimeout(() => applyCoupon(), 100);
            sessionStorage.removeItem('bridge55_coupon_code');
        }
    });
</script>
</body>
</html>
