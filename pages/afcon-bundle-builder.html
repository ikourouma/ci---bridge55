<!DOCTYPE html>
<html lang="en" data-country="pan-african">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AfCON Bundle Builder | Bridge55</title>
    <meta name="description" content="Build an AfCON match-week bundle: ticket + hospitality + add-ons. Pay with BridgeWallet." />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Jost:wght@500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/global-layout.css">
    <script src="../js/african-countries.js"></script>

    <style>
        :root {
            --text: #0a2540;
            --muted: #425466;
            --primary: #FF6B35;
            --border: rgba(0,0,0,0.08);
        }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; color: var(--text); background: #fff; }
        h1, h2, h3 { font-family: 'Jost', sans-serif; letter-spacing: -0.02em; }

        .breadcrumb-bar {
            position: fixed;
            top: 64px;
            left: 0;
            right: 0;
            height: 40px;
            z-index: 999;
            background: linear-gradient(135deg, #0a2540 0%, #051b2e 100%);
            border-bottom: 1px solid rgba(255,255,255,0.10);
            display: flex;
            align-items: center;
            opacity: 0;
            transform: translateY(-6px);
            transition: all 0.25s ease;
            pointer-events: none;
        }
        .breadcrumb-bar.visible { opacity: 1; transform: translateY(0); pointer-events: auto; }
        .breadcrumb-inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.25rem;
            width: 100%;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            color: rgba(255,255,255,0.9);
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .breadcrumb-link { color: rgba(255,255,255,0.9); text-decoration: none; display: inline-flex; align-items: center; gap: 0.45rem; }
        .breadcrumb-link:hover { color: #fff; text-decoration: underline; }
        .breadcrumb-sep { color: rgba(255,255,255,0.5); }
        .breadcrumb-current { display: inline-flex; align-items: center; gap: 0.45rem; color: #fff; font-weight: 900; }

        .hero {
            background: radial-gradient(900px 420px at 20% 20%, rgba(255,107,53,0.16), transparent 60%),
                        linear-gradient(135deg, #0a2540 0%, #051b2e 100%);
            color: #fff;
            padding: calc(2.0rem + 40px) 0 1.75rem;
            position: relative;
            overflow: hidden;
        }
        .hero::before {
            content: "";
            position: absolute;
            inset: 0;
            background: url("https://images.unsplash.com/photo-1522778119026-d647f0596c20?auto=format&fit=crop&w=2000&q=80") center/cover;
            opacity: 0.12;
        }
        .hero .hero-inner { position: relative; z-index: 1; }
        .hero-title { font-size: clamp(1.85rem, 3.2vw, 2.6rem); font-weight: 900; margin: 0.6rem 0 0.35rem; }
        .hero-sub { color: rgba(255,255,255,0.84); max-width: 900px; margin: 0; }
        .stepper {
            margin-top: 1rem;
            display: flex;
            gap: 0.6rem;
            flex-wrap: wrap;
        }
        .step {
            display: inline-flex;
            align-items: center;
            gap: 0.55rem;
            padding: 0.5rem 0.75rem;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,0.18);
            background: rgba(255,255,255,0.06);
            color: rgba(255,255,255,0.92);
            font-weight: 900;
            font-size: 0.85rem;
        }
        .step .num {
            width: 22px;
            height: 22px;
            border-radius: 999px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.14);
            border: 1px solid rgba(255,255,255,0.18);
            font-size: 0.78rem;
        }
        .step.active {
            border-color: rgba(255,107,53,0.45);
            background: rgba(255,107,53,0.12);
            color: #fff;
        }
        .step.done {
            border-color: rgba(34,197,94,0.45);
            background: rgba(34,197,94,0.12);
        }

        .section { padding: 2rem 0; }
        .panel {
            background: #fff;
            border: 1px solid rgba(0,0,0,0.08);
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .panel-header {
            padding: 1rem 1.1rem;
            border-bottom: 1px solid rgba(0,0,0,0.06);
            background: linear-gradient(135deg, rgba(255,107,53,0.08), rgba(0,78,137,0.06));
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .panel-title { font-weight: 900; margin: 0; }
        .panel-body { padding: 1.1rem; }
        .muted { color: var(--muted); font-weight: 650; }

        .form-select, .form-control {
            border-radius: 12px;
            border: 1px solid rgba(0,0,0,0.10);
            padding: 0.75rem 0.85rem;
            font-weight: 700;
        }

        .rowx { display: grid; grid-template-columns: 1fr 360px; gap: 1rem; }
        @media (max-width: 992px) { .rowx { grid-template-columns: 1fr; } }
        @media (min-width: 992px) {
            .sticky-summary { position: sticky; top: calc(64px + 54px); }
        }

        .btn-primary-b55 {
            background: linear-gradient(135deg, var(--primary) 0%, #e85d2a 100%);
            border: none;
            color: #fff;
            padding: 0.75rem 1rem;
            border-radius: 12px;
            font-weight: 900;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        .btn-ghost-b55 {
            border: 1px solid rgba(0,0,0,0.10);
            color: #0a2540;
            background: rgba(255,255,255,0.9);
            padding: 0.75rem 1rem;
            border-radius: 12px;
            font-weight: 900;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }
        .btn-ghost-b55:hover { border-color: rgba(255,107,53,0.55); }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            padding: 0.28rem 0.65rem;
            border-radius: 999px;
            border: 1px solid rgba(0,0,0,0.10);
            font-weight: 900;
            font-size: 0.78rem;
            background: rgba(255,255,255,0.8);
        }

        .line { display: flex; align-items: center; justify-content: space-between; gap: 0.75rem; padding: 0.45rem 0; border-bottom: 1px solid rgba(0,0,0,0.06); }
        .line:last-child { border-bottom: none; }
        .line strong { font-weight: 900; }
        .marketing-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; }
        @media (max-width: 768px) { .marketing-grid { grid-template-columns: 1fr; } }
        .mcard {
            border: 1px solid rgba(0,0,0,0.10);
            border-radius: 14px;
            padding: 0.9rem;
            background: #fff;
            text-decoration: none;
            color: var(--text);
            box-shadow: 0 6px 16px rgba(0,0,0,0.06);
            display: grid;
            gap: 0.35rem;
        }
        .mcard .k { font-weight: 900; font-size: 0.82rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.06em; }
        .mcard .t { font-weight: 900; }
        .mcard .d { color: var(--muted); font-weight: 650; font-size: 0.92rem; }
        .mcard.sponsored { border-style: dashed; background: rgba(255,107,53,0.06); }
        .mcard:hover { border-color: rgba(255,107,53,0.55); }
    </style>
</head>
<body>
    <nav class="breadcrumb-bar" id="breadcrumbBar" aria-label="Breadcrumb">
        <div class="breadcrumb-inner">
            <a href="../index.html" class="breadcrumb-link"><i class="fa-solid fa-house"></i><span>Home</span></a>
            <span class="breadcrumb-sep"><i class="fa-solid fa-chevron-right"></i></span>
            <a href="afcon.html" class="breadcrumb-link"><i class="fa-solid fa-trophy"></i><span>AfCON</span></a>
            <span class="breadcrumb-sep"><i class="fa-solid fa-chevron-right"></i></span>
            <span class="breadcrumb-current"><i class="fa-solid fa-layer-group"></i><span>Bundle builder</span></span>
        </div>
    </nav>

    <div id="global-header"></div>

    <section class="hero">
        <div class="hero-inner bridge-container">
            <div class="d-flex gap-2 flex-wrap">
                <span class="pill"><i class="fa-solid fa-ticket"></i> Ticket</span>
                <span class="pill"><i class="fa-solid fa-champagne-glasses"></i> Hospitality</span>
                <span class="pill"><i class="fa-solid fa-wallet"></i> BridgeWallet</span>
            </div>
            <h1 class="hero-title">Build your AfCON bundle</h1>
            <p class="hero-sub">Demo bundle: ticket + hospitality + optional add-ons (transfer, stay). Checkout uses the same BridgeWallet receipt flow.</p>
            <div class="stepper" aria-label="Bundle steps">
                <div class="step active" id="step1"><span class="num">1</span> Select match</div>
                <div class="step" id="step2"><span class="num">2</span> Add hospitality</div>
                <div class="step" id="step3"><span class="num">3</span> Add extras</div>
                <div class="step" id="step4"><span class="num">4</span> Pay (Wallet)</div>
            </div>
        </div>
    </section>

    <main class="section">
        <div class="bridge-container">
            <div class="rowx">
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">Select items</div>
                        <a class="btn-ghost-b55" href="afcon-hospitality.html"><i class="fa-solid fa-chevron-left"></i> Back</a>
                    </div>
                    <div class="panel-body">
                        <div class="mb-3">
                            <label class="muted" style="display:block; margin-bottom:0.4rem;">Match ticket</label>
                            <select class="form-select" id="matchSelect" aria-label="Select a match"></select>
                        </div>

                        <div class="mb-3">
                            <label class="muted" style="display:block; margin-bottom:0.4rem;">Hospitality package</label>
                            <select class="form-select" id="hospitalitySelect" aria-label="Select a hospitality package"></select>
                        </div>

                        <div class="mb-3">
                            <label class="muted" style="display:block; margin-bottom:0.5rem;">Optional add-ons</label>
                            <div class="d-grid gap-2">
                                <label class="btn-ghost-b55" style="justify-content:space-between;">
                                    <span><i class="fa-solid fa-van-shuttle"></i> Airport transfer (demo)</span>
                                    <span>
                                        <strong>$35</strong>
                                        <input type="checkbox" id="addonTransfer" style="margin-left:0.6rem; transform: translateY(1px);" />
                                    </span>
                                </label>
                                <label class="btn-ghost-b55" style="justify-content:space-between;">
                                    <span><i class="fa-solid fa-bed"></i> 1-night stay nearby (demo)</span>
                                    <span>
                                        <strong>$90</strong>
                                        <input type="checkbox" id="addonStay" style="margin-left:0.6rem; transform: translateY(1px);" />
                                    </span>
                                </label>
                            </div>
                            <div class="muted mt-2">
                                Add-ons are placeholders for now. You can also browse real options:
                                <a href="../transfers/search-results.html" style="color: var(--primary); font-weight: 900; text-decoration: none;">Transfers</a>
                                ·
                                <a href="../stays/search-results-list.html" style="color: var(--primary); font-weight: 900; text-decoration: none;">Stays</a>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="muted" style="display:block; margin-bottom:0.5rem;">Discover (AfCON marketing slots)</label>
                            <div class="marketing-grid">
                                <a class="mcard" href="afcon-hospitality.html">
                                    <div class="k">Official hospitality</div>
                                    <div class="t">Browse packages</div>
                                    <div class="d">Curated tiers, venues, and match-day upgrades.</div>
                                </a>
                                <a class="mcard" href="afcon-fan-hub.html">
                                    <div class="k">Fan hub</div>
                                    <div class="t">Watch parties + contests</div>
                                    <div class="d">Influencers, fan festivals, and local activations.</div>
                                </a>
                                <a class="mcard sponsored" href="afcon-marketplace.html">
                                    <div class="k">Sponsored slot</div>
                                    <div class="t">Marketplace (placeholder)</div>
                                    <div class="d">Future: official merch + local creator drops.</div>
                                </a>
                            </div>
                        </div>

                        <div class="d-flex gap-2 flex-wrap">
                            <button class="btn-primary-b55" id="checkoutBtn" type="button"><i class="fa-solid fa-lock"></i> Checkout with wallet</button>
                            <a class="btn-ghost-b55" id="ticketOnlyBtn" href="afcon-ticket-checkout.html?matchId=1"><i class="fa-solid fa-ticket"></i> Ticket only</a>
                            <a class="btn-ghost-b55" id="hospOnlyBtn" href="afcon-ticket-checkout.html?hospitalityId=H1"><i class="fa-solid fa-champagne-glasses"></i> Hospitality only</a>
                        </div>
                    </div>
                </div>

                <div class="panel sticky-summary">
                    <div class="panel-header">
                        <div class="panel-title">Summary</div>
                        <div class="pill"><i class="fa-solid fa-tag"></i> <span id="totalPill">$0.00</span></div>
                    </div>
                    <div class="panel-body" id="summary">
                        <div class="muted">Select a match and package to see a full breakdown.</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="global-footer"></div>

    <script>
        const AFCON_DB_KEY = 'bridge55-afcon-db';
        const AFCON_BUNDLE_KEY = 'bridge55-afcon-bundle';
        const WALLET_BAL_KEY = 'bridge55-wallet-balance';

        const breadcrumbBar = document.getElementById('breadcrumbBar');
        window.addEventListener('scroll', () => {
            if (!breadcrumbBar) return;
            breadcrumbBar.classList.toggle('visible', window.scrollY > 120);
        });

        const FALLBACK_MATCHES = [
            { id: 1, date: '2025-12-21', time: '18:00', stage: 'Group', group: 'A', city: 'Abidjan', stadium: 'Stade Félix Houphouët-Boigny', home: "Côte d'Ivoire", away: 'Nigeria' },
            { id: 2, date: '2025-12-22', time: '20:00', stage: 'Group', group: 'B', city: 'Dakar', stadium: 'Stade Abdoulaye Wade', home: 'Senegal', away: 'Ghana' },
            { id: 3, date: '2025-12-24', time: '18:15', stage: 'Group', group: 'C', city: 'Casablanca', stadium: 'Mohammed V Stadium', home: 'Morocco', away: 'Cameroon' }
        ];

        const FALLBACK_PACKAGES = [
            { id: 'H1', title: 'Atlas Lounge — Abidjan', city: 'Abidjan', stadium: 'Stade Félix Houphouët-Boigny', tier: 'Lounge', price: 220, approved: true, showInBundle: true },
            { id: 'H2', title: 'Rose Suites — Dakar', city: 'Dakar', stadium: 'Stade Abdoulaye Wade', tier: 'Suite', price: 420, approved: true, showInBundle: true },
            { id: 'H3', title: 'Matchday Upgrade — Casablanca', city: 'Casablanca', stadium: 'Mohammed V Stadium', tier: 'Upgrade', price: 140, approved: true, showInBundle: true }
        ];

        function loadPackages() {
            try {
                const raw = localStorage.getItem(AFCON_DB_KEY);
                const db = raw ? safeParse(raw) : null;
                const pkgs = (db && Array.isArray(db.packages)) ? db.packages : null;
                if (pkgs && pkgs.length) return pkgs.filter(p => p && p.approved !== false && p.showInBundle !== false);
            } catch {}
            return FALLBACK_PACKAGES;
        }

        function safeParse(json) { try { return JSON.parse(json); } catch { return null; } }
        function fmtMoney(v) { return `$${Number(v).toFixed(2)}`; }
        function getWalletBalance() {
            try {
                const v = Number(localStorage.getItem(WALLET_BAL_KEY));
                if (Number.isFinite(v)) return v;
                localStorage.setItem(WALLET_BAL_KEY, String(75));
                return 75;
            } catch { return 75; }
        }

        function loadMatches() {
            try {
                const raw = localStorage.getItem(AFCON_DB_KEY);
                const db = raw ? safeParse(raw) : null;
                if (db && Array.isArray(db.matches) && db.matches.length) return db.matches;
            } catch {}
            return FALLBACK_MATCHES;
        }

        function optionLabelForMatch(m) {
            const stage = m.stage || 'Match';
            const group = (m.group ? ` • Group ${m.group}` : '');
            const dt = `${m.date || ''} ${m.time || ''}`.trim();
            const teams = `${m.home || 'TBD'} vs ${m.away || 'TBD'}`;
            const loc = `${m.city || ''} • ${m.stadium || ''}`.trim();
            return `${teams} — ${stage}${group} — ${dt} — ${loc}`;
        }

        function priceForStage(stage) {
            switch (String(stage || '').toLowerCase()) {
                case 'final': return 120;
                case 'sf': return 85;
                case 'qf': return 70;
                case 'r16': return 55;
                default: return 35;
            }
        }

        function setInitialSelections(matches) {
            const params = new URLSearchParams(window.location.search);
            const hospitalityId = params.get('hospitalityId');
            if (hospitalityId && document.getElementById('hospitalitySelect')) {
                document.getElementById('hospitalitySelect').value = hospitalityId;
            }
        }

        function buildBundle() {
            const matches = loadMatches();
            const matchId = document.getElementById('matchSelect')?.value;
            const hospId = document.getElementById('hospitalitySelect')?.value;
            const match = matches.find(m => String(m.id) === String(matchId)) || null;
            const pkgs = loadPackages();
            const pkg = pkgs.find(p => String(p.id) === String(hospId)) || null;
            const addTransfer = !!document.getElementById('addonTransfer')?.checked;
            const addStay = !!document.getElementById('addonStay')?.checked;

            const ticketPrice = match ? priceForStage(match.stage) : 0;
            const hospPrice = pkg ? Number(pkg.price) : 0;
            const transferPrice = addTransfer ? 35 : 0;
            const stayPrice = addStay ? 90 : 0;
            const total = ticketPrice + hospPrice + transferPrice + stayPrice;

            const items = [];
            if (match) items.push({ type: 'ticket', label: `${match.home} vs ${match.away}`, price: ticketPrice, meta: match });
            if (pkg) items.push({ type: 'hospitality', label: pkg.title, price: hospPrice, meta: pkg });
            if (addTransfer) items.push({ type: 'transfer', label: 'Airport transfer (demo)', price: transferPrice });
            if (addStay) items.push({ type: 'stay', label: '1-night stay nearby (demo)', price: stayPrice });

            const bundle = {
                label: 'AfCON bundle',
                total,
                items,
                createdAt: new Date().toISOString()
            };
            try { sessionStorage.setItem(AFCON_BUNDLE_KEY, JSON.stringify(bundle)); } catch {}

            // Update summary UI
            const totalPill = document.getElementById('totalPill');
            if (totalPill) totalPill.textContent = fmtMoney(total);

            const summary = document.getElementById('summary');
            if (summary) {
                if (!match || !pkg) {
                    summary.innerHTML = `<div class="muted">Select a match and a hospitality package to enable checkout.</div>`;
                } else {
                    const lines = items.map(i => `
                        <div class="line">
                            <div>
                                <strong>${i.type.toUpperCase()}</strong>
                                <div class="muted">${i.label}</div>
                            </div>
                            <div style="font-weight:900;">${fmtMoney(i.price)}</div>
                        </div>
                    `).join('');
                    summary.innerHTML = `
                        ${lines}
                        <div class="line" style="padding-top:0.75rem;">
                            <div style="font-weight:900; font-size:1.05rem;">Total</div>
                            <div style="font-weight:900; font-size:1.05rem;">${fmtMoney(total)}</div>
                        </div>
                    `;
                }
            }

            // Wire CTAs
            const ticketOnly = document.getElementById('ticketOnlyBtn');
            const hospOnly = document.getElementById('hospOnlyBtn');
            if (ticketOnly && match) ticketOnly.href = `afcon-ticket-checkout.html?matchId=${encodeURIComponent(match.id)}`;
            if (hospOnly && pkg) hospOnly.href = `afcon-ticket-checkout.html?hospitalityId=${encodeURIComponent(pkg.id)}`;

            const checkoutBtn = document.getElementById('checkoutBtn');
            if (checkoutBtn) checkoutBtn.disabled = !(match && pkg && total > 0);

            // Stepper state
            const setStepState = (id, state) => {
                const el = document.getElementById(id);
                if (!el) return;
                el.classList.remove('active', 'done');
                if (state === 'active') el.classList.add('active');
                if (state === 'done') el.classList.add('done');
            };
            setStepState('step1', match ? 'done' : 'active');
            setStepState('step2', match && pkg ? 'done' : (match ? 'active' : ''));
            setStepState('step3', match && pkg && (addTransfer || addStay) ? 'done' : (match && pkg ? 'active' : ''));
            setStepState('step4', match && pkg ? 'active' : '');
        }

        document.addEventListener('DOMContentLoaded', () => {
            const matches = loadMatches();

            const matchSelect = document.getElementById('matchSelect');
            if (matchSelect) {
                matchSelect.innerHTML = matches.map(m => `<option value="${m.id}">${optionLabelForMatch(m)}</option>`).join('');
            }
            const hospSelect = document.getElementById('hospitalitySelect');
            if (hospSelect) {
                const pkgs = loadPackages();
                hospSelect.innerHTML = pkgs.map(p => `<option value="${p.id}">${p.title} — ${p.tier} — ${p.city} — ${fmtMoney(p.price)}</option>`).join('');
            }

            // Prefill from query string (e.g., from hospitality catalog)
            setInitialSelections(matches);

            // Build summary initially
            buildBundle();

            matchSelect?.addEventListener('change', buildBundle);
            hospSelect?.addEventListener('change', buildBundle);
            document.getElementById('addonTransfer')?.addEventListener('change', buildBundle);
            document.getElementById('addonStay')?.addEventListener('change', buildBundle);

            document.getElementById('checkoutBtn')?.addEventListener('click', () => {
                buildBundle(); // ensure latest saved
                window.location.href = 'afcon-ticket-checkout.html?bundle=1';
            });

            fetch('../components/global-header.html')
                .then(r => r.text())
                .then(html => {
                    const c = document.getElementById('global-header');
                    c.innerHTML = html;
                    c.querySelectorAll('script').forEach(oldScript => {
                        const s = document.createElement('script');
                        Array.from(oldScript.attributes).forEach(a => s.setAttribute(a.name, a.value));
                        s.textContent = oldScript.textContent;
                        oldScript.parentNode.replaceChild(s, oldScript);
                    });
                })
                .catch(err => console.log('Header not loaded:', err));

            fetch('../components/global-footer.html')
                .then(r => r.text())
                .then(html => { document.getElementById('global-footer').innerHTML = html; })
                .catch(err => console.log('Footer not loaded:', err));
        });
    </script>
</body>
</html>


